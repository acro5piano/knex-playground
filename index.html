<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <title>Knex Playground</title>

    <style type="text/css">
        html,body,.ctn{background:#1E1E1E;margin:0;padding:0;display:block;width:100%;height:100%}
        .ctn{width:50%;float:left}
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bluebird/2.9.24/bluebird.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.7.0/lodash.js"></script>
    <script src="knex.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.16.2/min/vs/loader.js"></script>

    <script type="text/javascript">
        require.config({ paths: { "vs": "https://cdn.jsdelivr.net/npm/monaco-editor@0.16.2/min/vs/" }});

        window.MonacoEnvironment = {
            getWorkerUrl: function(workerId, label) {
                return `data:text/javascript;charset=utf-8,${encodeURIComponent(`
                    self.MonacoEnvironment = {
                        baseUrl: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.16.2/min/'
                    };

                    importScripts('https://cdn.jsdelivr.net/npm/monaco-editor@0.16.2/min/vs/base/worker/workerMain.js');`
                )}`;
            }
        };

        require(["vs/editor/editor.main"], function() {
            monaco.languages.typescript.typescriptDefaults.addExtraLib("type Callback=(...args:any[])=>void;type Client=(...args:any[])=>void;type Value=string|number|boolean|Date|string[]|number[]|Date[]|boolean[]|Buffer|Knex.Raw;interface ValueMap{[key:string]:Value|Knex.QueryBuilder}type ColumnName=string|Knex.Raw|Knex.QueryBuilder|{[key:string]:string};type TableName=string|Knex.Raw|Knex.QueryBuilder;interface Identifier{[alias:string]:string}interface Knex extends Knex.QueryInterface{(tableName?:TableName|Identifier):Knex.QueryBuilder;VERSION:string;__knex__:string;raw:Knex.RawBuilder;transaction<T>(transactionScope:(trx:Knex.Transaction)=>Promise<T>|Promise<T>|void):Promise<T>;destroy(callback:(...args:any[])=>void):void;destroy():Promise<void>;batchInsert(tableName:TableName,data:any[],chunkSize?:number):Knex.QueryBuilder;schema:Knex.SchemaBuilder;queryBuilder():Knex.QueryBuilder;client:any;migrate:Knex.Migrator;seed:any;fn:Knex.FunctionHelper;on(eventName:string,callback:(...args:any[])=>void):Knex.QueryBuilder}declare function Knex(config:Knex.Config):Knex;declare namespace Knex{interface QueryInterface{select:Select;as:As;columns:Select;column:Select;from:Table;into:Table;table:Table;distinct:Distinct;join:Join;joinRaw:JoinRaw;innerJoin:Join;leftJoin:Join;leftOuterJoin:Join;rightJoin:Join;rightOuterJoin:Join;outerJoin:Join;fullOuterJoin:Join;crossJoin:Join;with:With;withRaw:WithRaw;withSchema:WithSchema;withWrapped:WithWrapped;where:Where;andWhere:Where;orWhere:Where;whereNot:Where;andWhereNot:Where;orWhereNot:Where;whereRaw:WhereRaw;orWhereRaw:WhereRaw;andWhereRaw:WhereRaw;whereWrapped:WhereWrapped;havingWrapped:WhereWrapped;whereExists:WhereExists;orWhereExists:WhereExists;whereNotExists:WhereExists;orWhereNotExists:WhereExists;whereIn:WhereIn;orWhereIn:WhereIn;whereNotIn:WhereIn;orWhereNotIn:WhereIn;whereNull:WhereNull;orWhereNull:WhereNull;whereNotNull:WhereNull;orWhereNotNull:WhereNull;whereBetween:WhereBetween;orWhereBetween:WhereBetween;andWhereBetween:WhereBetween;whereNotBetween:WhereBetween;orWhereNotBetween:WhereBetween;andWhereNotBetween:WhereBetween;groupBy:GroupBy;groupByRaw:RawQueryBuilder;orderBy:OrderBy;orderByRaw:RawQueryBuilder;union:Union;unionAll(callback:QueryCallback):QueryBuilder;having:Having;andHaving:Having;havingRaw:RawQueryBuilder;orHaving:Having;orHavingRaw:RawQueryBuilder;havingIn:HavingIn;clearOrder():QueryBuilder;clearSelect():QueryBuilder;clearWhere():QueryBuilder;offset(offset:number):QueryBuilder;limit(limit:number):QueryBuilder;count(...columnNames:string[]):QueryBuilder;count(columnName:Record<string,string|string[]|Raw>|Raw):QueryBuilder;countDistinct(columnName:string|Record<string,string|Raw>|Raw):QueryBuilder;min(columnName:string,...columnNames:string[]):QueryBuilder;min(columnName:Record<string,string|string[]|Raw>|Raw):QueryBuilder;max(columnName:string,...columnNames:string[]):QueryBuilder;max(columnName:Record<string,string|string[]|Raw>|Raw):QueryBuilder;sum(columnName:string,...columnNames:string[]):QueryBuilder;sum(columnName:Record<string,string|string[]|Raw>|Raw):QueryBuilder;sumDistinct(columnName:string|Record<string,string|Raw>|Raw):QueryBuilder;avg(columnName:string,...columnNames:string[]):QueryBuilder;avg(columnName:Record<string,string|string[]|Raw>|Raw):QueryBuilder;avgDistinct(columnName:string|Record<string,string|Raw>|Raw):QueryBuilder;increment(columnName:string,amount?:number):QueryBuilder;decrement(columnName:string,amount?:number):QueryBuilder;first:Select;pluck(column:string):QueryBuilder;insert(data:any,returning?:string|string[]):QueryBuilder;modify(callback:QueryCallbackWithArgs,...args:any[]):QueryBuilder;update(data:any,returning?:string|string[]):QueryBuilder;update(columnName:string,value:Value,returning?:string|string[]):QueryBuilder;returning(column:string|string[]):QueryBuilder;del(returning?:string|string[]):QueryBuilder;delete(returning?:string|string[]):QueryBuilder;truncate():QueryBuilder;clone():QueryBuilder}interface As{(columnName:string):QueryBuilder}interface Select extends ColumnNameQueryBuilder{(aliases:{[alias:string]:string}):QueryBuilder}interface Table{(tableName:TableName|Identifier|Function|Raw):QueryBuilder}interface Distinct extends ColumnNameQueryBuilder{}interface JoinCallback{(this:JoinClause,join:JoinClause):void}interface Join{(raw:Raw):QueryBuilder;(tableName:TableName|QueryCallback,clause:JoinCallback):QueryBuilder;(tableName:TableName|QueryCallback,columns:{[key:string]:string|number|Raw}):QueryBuilder;(tableName:TableName|QueryCallback,raw:Raw):QueryBuilder;(tableName:TableName|QueryCallback,column1:string,column2:string):QueryBuilder;(tableName:TableName|QueryCallback,column1:string,raw:Raw):QueryBuilder;(tableName:TableName|QueryCallback,column1:string,operator:string,column2:string):QueryBuilder}interface JoinClause{on(raw:Raw):JoinClause;on(callback:JoinCallback):JoinClause;on(columns:{[key:string]:string|Raw}):JoinClause;on(column1:string,column2:string):JoinClause;on(column1:string,raw:Raw):JoinClause;on(column1:string,operator:string,column2:string|Raw):JoinClause;andOn(raw:Raw):JoinClause;andOn(callback:JoinCallback):JoinClause;andOn(columns:{[key:string]:string|Raw}):JoinClause;andOn(column1:string,column2:string):JoinClause;andOn(column1:string,raw:Raw):JoinClause;andOn(column1:string,operator:string,column2:string|Raw):JoinClause;orOn(raw:Raw):JoinClause;orOn(callback:JoinCallback):JoinClause;orOn(columns:{[key:string]:string|Raw}):JoinClause;orOn(column1:string,column2:string):JoinClause;orOn(column1:string,raw:Raw):JoinClause;orOn(column1:string,operator:string,column2:string|Raw):JoinClause;onIn(column1:string,values:any[]):JoinClause;andOnIn(column1:string,values:any[]):JoinClause;orOnIn(column1:string,values:any[]):JoinClause;onNotIn(column1:string,values:any[]):JoinClause;andOnNotIn(column1:string,values:any[]):JoinClause;orOnNotIn(column1:string,values:any[]):JoinClause;onNull(column1:string):JoinClause;andOnNull(column1:string):JoinClause;orOnNull(column1:string):JoinClause;onNotNull(column1:string):JoinClause;andOnNotNull(column1:string):JoinClause;orOnNotNull(column1:string):JoinClause;onExists(callback:QueryCallback):JoinClause;andOnExists(callback:QueryCallback):JoinClause;orOnExists(callback:QueryCallback):JoinClause;onNotExists(callback:QueryCallback):JoinClause;andOnNotExists(callback:QueryCallback):JoinClause;orOnNotExists(callback:QueryCallback):JoinClause;onBetween(column1:string,range:[any,any]):JoinClause;andOnBetween(column1:string,range:[any,any]):JoinClause;orOnBetween(column1:string,range:[any,any]):JoinClause;onNotBetween(column1:string,range:[any,any]):JoinClause;andOnNotBetween(column1:string,range:[any,any]):JoinClause;orOnNotBetween(column1:string,range:[any,any]):JoinClause;using(column:string|string[]|Raw|{[key:string]:string|Raw}):JoinClause;type(type:string):JoinClause}interface JoinRaw{(tableName:string,binding?:Value):QueryBuilder}interface With extends WithRaw,WithWrapped{}interface WithRaw{(alias:string,raw:Raw):QueryBuilder;(alias:string,sql:string,bindings?:Value[]|object):QueryBuilder}interface WithSchema{(schema:string):QueryBuilder}interface WithWrapped{(alias:string,queryBuilder:QueryBuilder):QueryBuilder;(alias:string,callback:(queryBuilder:QueryBuilder)=>any):QueryBuilder}interface Where extends WhereRaw,WhereWrapped,WhereNull{(raw:Raw):QueryBuilder;(callback:QueryCallback):QueryBuilder;(object:object):QueryBuilder;(columnName:string,value:Value|null):QueryBuilder;(columnName:string,operator:string,value:Value|QueryBuilder|null):QueryBuilder;(left:Raw,operator:string,right:Value|QueryBuilder|null):QueryBuilder}interface WhereRaw extends RawQueryBuilder{(condition:boolean):QueryBuilder}interface WhereWrapped{(callback:QueryCallback):QueryBuilder}interface WhereNull{(columnName:string):QueryBuilder}interface WhereBetween{(columnName:string,range:[Value,Value]):QueryBuilder}interface WhereExists{(callback:QueryCallback):QueryBuilder;(query:QueryBuilder):QueryBuilder}interface WhereNull{(columnName:string):QueryBuilder}interface WhereIn{(columnName:string,values:Value[]|QueryBuilder|QueryCallback):QueryBuilder;(columnNames:string[],values:Value[][]|QueryBuilder|QueryCallback):QueryBuilder}interface GroupBy extends RawQueryBuilder,ColumnNameQueryBuilder{}interface OrderBy{(columnName:string,direction?:string):QueryBuilder}interface Union{(callback:QueryCallback|QueryBuilder|Raw,wrap?:boolean):QueryBuilder;(callbacks:Array<QueryCallback|QueryBuilder|Raw>,wrap?:boolean):QueryBuilder;(...callbacks:Array<QueryCallback|QueryBuilder|Raw>):QueryBuilder}interface Having extends RawQueryBuilder,WhereWrapped{(tableName:string,column1:string,operator:string,column2:string):QueryBuilder}interface HavingIn{(columnName:string,values:Value[]):QueryBuilder}interface ColumnNameQueryBuilder{(...columnNames:ColumnName[]):QueryBuilder;(columnNames:ColumnName[]):QueryBuilder}interface RawQueryBuilder{(sql:string,...bindings:Array<Value|QueryBuilder>):QueryBuilder;(sql:string,bindings:Array<Value|QueryBuilder>|ValueMap):QueryBuilder;(raw:Raw):QueryBuilder}interface Raw extends ChainableInterface{wrap(before:string,after:string):Raw}interface RawBuilder{(value:Value):Raw;(sql:string,...bindings:Array<Value|QueryBuilder>):Raw;(sql:string,bindings:Array<Value|QueryBuilder>|ValueMap):Raw}type QueryCallback=(this:QueryBuilder,builder:QueryBuilder)=>void;type QueryCallbackWithArgs=(this:QueryBuilder,builder:QueryBuilder,...args:any[])=>void;interface QueryBuilder extends QueryInterface,ChainableInterface{or:QueryBuilder;and:QueryBuilder;columnInfo(column?:string):Promise<ColumnInfo>;forUpdate():QueryBuilder;forShare():QueryBuilder;toSQL():Sql;on(event:string,callback:(...args:any[])=>void):QueryBuilder}interface Sql{method:string;options:any;bindings:Value[];sql:string}interface ChainableInterface extends Promise<any>{toQuery():string;options(options:{[key:string]:any}):this;connection(connection:any):this;debug(enabled:boolean):this;transacting(trx:Transaction):this;stream(handler:(readable:any)=>any):Promise<any>;stream(options:{[key:string]:any},handler:(readable:any)=>any):Promise<any>;stream(options?:{[key:string]:any}):any;pipe<T extends NodeJS.WritableStream>(writable:T,options?:{[key:string]:any}):any}interface Transaction extends Knex{savepoint(transactionScope:(trx:Transaction)=>any):Promise<any>;commit(value?:any):QueryBuilder;rollback(error?:any):QueryBuilder}interface SchemaBuilder extends ChainableInterface{createTable(tableName:string,callback:(tableBuilder:CreateTableBuilder)=>any):SchemaBuilder;createTableIfNotExists(tableName:string,callback:(tableBuilder:CreateTableBuilder)=>any):SchemaBuilder;alterTable(tableName:string,callback:(tableBuilder:CreateTableBuilder)=>any):SchemaBuilder;renameTable(oldTableName:string,newTableName:string):Promise<void>;dropTable(tableName:string):SchemaBuilder;hasTable(tableName:string):Promise<boolean>;hasColumn(tableName:string,columnName:string):Promise<boolean>;table(tableName:string,callback:(tableBuilder:AlterTableBuilder)=>any):Promise<void>;dropTableIfExists(tableName:string):SchemaBuilder;raw(statement:string):SchemaBuilder;withSchema(schemaName:string):SchemaBuilder}interface TableBuilder{increments(columnName?:string):ColumnBuilder;bigIncrements(columnName?:string):ColumnBuilder;dropColumn(columnName:string):TableBuilder;dropColumns(...columnNames:string[]):TableBuilder;renameColumn(from:string,to:string):ColumnBuilder;integer(columnName:string):ColumnBuilder;bigInteger(columnName:string):ColumnBuilder;text(columnName:string,textType?:string):ColumnBuilder;string(columnName:string,length?:number):ColumnBuilder;float(columnName:string,precision?:number,scale?:number):ColumnBuilder;decimal(columnName:string,precision?:number|null,scale?:number):ColumnBuilder;boolean(columnName:string):ColumnBuilder;date(columnName:string):ColumnBuilder;dateTime(columnName:string):ColumnBuilder;time(columnName:string):ColumnBuilder;timestamp(columnName:string,standard?:boolean):ColumnBuilder;timestamps(useTimestampType?:boolean,makeDefaultNow?:boolean):ColumnBuilder;binary(columnName:string,length?:number):ColumnBuilder;enum(columnName:string,values:Value[],options?:EnumOptions):ColumnBuilder;enu(columnName:string,values:Value[],options?:EnumOptions):ColumnBuilder;json(columnName:string):ColumnBuilder;jsonb(columnName:string):ColumnBuilder;uuid(columnName:string):ColumnBuilder;comment(val:string):TableBuilder;specificType(columnName:string,type:string):ColumnBuilder;primary(columnNames:string[]):TableBuilder;index(columnNames:Array<string|Raw>,indexName?:string,indexType?:string):TableBuilder;unique(columnNames:Array<string|Raw>,indexName?:string):TableBuilder;foreign(column:string,foreignKeyName?:string):ForeignConstraintBuilder;foreign(columns:string[],foreignKeyName?:string):MultikeyForeignConstraintBuilder;dropForeign(columnNames:string[],foreignKeyName?:string):TableBuilder;dropUnique(columnNames:Array<string|Raw>,indexName?:string):TableBuilder;dropPrimary(constraintName?:string):TableBuilder;dropIndex(columnNames:Array<string|Raw>,indexName?:string):TableBuilder;dropTimestamps():ColumnBuilder}interface CreateTableBuilder extends TableBuilder{}interface MySqlTableBuilder extends CreateTableBuilder{engine(val:string):CreateTableBuilder;charset(val:string):CreateTableBuilder;collate(val:string):CreateTableBuilder}interface AlterTableBuilder extends TableBuilder{}interface MySqlAlterTableBuilder extends AlterTableBuilder{}interface ColumnBuilder{index(indexName?:string):ColumnBuilder;primary(constraintName?:string):ColumnBuilder;unique(indexName?:string):ColumnBuilder;references(columnName:string):ReferencingColumnBuilder;onDelete(command:string):ColumnBuilder;onUpdate(command:string):ColumnBuilder;defaultTo(value:Value):ColumnBuilder;unsigned():ColumnBuilder;notNullable():ColumnBuilder;nullable():ColumnBuilder;comment(value:string):ColumnBuilder;alter():ColumnBuilder}interface ForeignConstraintBuilder{references(columnName:string):ReferencingColumnBuilder}interface MultikeyForeignConstraintBuilder{references(columnNames:string[]):ReferencingColumnBuilder}interface PostgreSqlColumnBuilder extends ColumnBuilder{index(indexName?:string,indexType?:string):ColumnBuilder}interface ReferencingColumnBuilder extends ColumnBuilder{inTable(tableName:string):ColumnBuilder}interface AlterColumnBuilder extends ColumnBuilder{}interface MySqlAlterColumnBuilder extends AlterColumnBuilder{first():AlterColumnBuilder;after(columnName:string):AlterColumnBuilder}interface EnumOptions{useNative:boolean;enumName:string}interface ColumnInfo{defaultValue:Value;type:string;maxLength:number;nullable:boolean}interface Config{debug?:boolean;client?:string|typeof Client;dialect?:string;version?:string;connection?:string|ConnectionConfig|MariaSqlConnectionConfig|MySqlConnectionConfig|MsSqlConnectionConfig|Sqlite3ConnectionConfig|SocketConnectionConfig;pool?:PoolConfig;migrations?:MigratorConfig;postProcessResponse?:(result:any,queryContext:any)=>any;wrapIdentifier?:(value:string,origImpl:(value:string)=>string,queryContext:any)=>string;seeds?:SeedsConfig;acquireConnectionTimeout?:number;useNullAsDefault?:boolean;searchPath?:string|string[];asyncStackTraces?:boolean}interface ConnectionConfig{host:string;user:string;password:string;database:string;domain?:string;instanceName?:string;debug?:boolean;requestTimeout?:number}interface MsSqlConnectionConfig{user:string;password:string;server:string;database:string;options:MsSqlOptionsConfig}interface MariaSqlConnectionConfig{user?:string;password?:string;host?:string;port?:number;unixSocket?:string;protocol?:string;db?:string;keepQueries?:boolean;multiStatements?:boolean;connTimeout?:number;pingInterval?:number;secureAuth?:boolean;compress?:boolean;ssl?:boolean|MariaSslConfiguration;local_infile?:boolean;read_default_file?:string;read_default_group?:string;charset?:string;streamHWM?:number}interface MariaSslConfiguration{key?:string;cert?:string;ca?:string;capath?:string;cipher?:string;rejectUnauthorized?:boolean}interface MySqlConnectionConfig{host?:string;port?:number;localAddress?:string;socketPath?:string;user?:string;password?:string;database?:string;charset?:string;timezone?:string;connectTimeout?:number;stringifyObjects?:boolean;insecureAuth?:boolean;typeCast?:any;queryFormat?:(query:string,values:any)=>string;supportBigNumbers?:boolean;bigNumberStrings?:boolean;dateStrings?:boolean;debug?:boolean;trace?:boolean;multipleStatements?:boolean;flags?:string;ssl?:string|MariaSslConfiguration}interface Sqlite3ConnectionConfig{filename:string;debug?:boolean}interface MsSqlOptionsConfig{encrypt?:boolean;port?:number;domain?:string;connectionTimeout?:number;requestTimeout?:number;stream?:boolean;parseJSON?:boolean;pool?:PoolConfig}interface SocketConnectionConfig{socketPath:string;user:string;password:string;database:string;debug?:boolean}interface PoolConfig{name?:string;create?:(...args:any[])=>void;afterCreate?:(...args:any[])=>void;destroy?:(...args:any[])=>void;beforeDestroy?:(...args:any[])=>void;min?:number;max?:number;refreshIdle?:boolean;idleTimeoutMillis?:number;reapIntervalMillis?:number;returnToHead?:boolean;priorityRange?:number;validate?:(...args:any[])=>void;log?:boolean;maxWaitingClients?:number;testOnBorrow?:boolean;acquireTimeoutMillis?:number;fifo?:boolean;autostart?:boolean;evictionRunIntervalMillis?:number;numTestsPerRun?:number;softIdleTimeoutMillis?:number;Promise?:any}interface MigratorConfig{database?:string;directory?:string;extension?:string;tableName?:string;disableTransactions?:boolean}interface SeedsConfig{directory?:string}interface Migrator{make(name:string,config?:MigratorConfig):Promise<string>;latest(config?:MigratorConfig):Promise<any>;rollback(config?:MigratorConfig):Promise<any>;status(config?:MigratorConfig):Promise<number>;currentVersion(config?:MigratorConfig):Promise<string>}interface FunctionHelper{now():Raw}class Client{constructor(config:Config);config:Config;dialect:string;driverName:string;connectionSettings:object;acquireRawConnection():Promise<any>;destroyRawConnection(connection:any):Promise<void>;validateConnection(connection:any):Promise<boolean>}};declare const knex: Knex;", "knex.d.ts");

            var knexEditor = monaco.editor.create(document.getElementById("knex-container"), {
                value: "// Knex code\nknex(\"table\").select()\n",
                language: "typescript",
                scrollBeyondLastLine: false,
                readOnly: false,
                theme: "vs-dark",
            });

            var sqlEditor = monaco.editor.create(document.getElementById("sql-container"), {
                value: "--- generated SQL code\nselect * from table\n",
                language: "sql",
                scrollBeyondLastLine: false,
                readOnly: true,
                theme: "vs-dark",
            });

            knexEditor.onDidChangeModelContent(function (event) {
                var knex = Knex({ client: "pg" });

                try {
                    sqlEditor.getModel().setValue("--- generated SQL code\n" + eval(knexEditor.getModel().getValue()).toQuery() + "\n");
                } catch (error) {
                    sqlEditor.getModel().setValue("--- " + error.toString());
                }
            });

            window.addEventListener("resize", function() {
                knexEditor.layout();
                sqlEditor.layout();
                knexEditor.layout();
                sqlEditor.layout();
            });
        });
    </script>
</head>
<body>
    <div class="ctn" id="knex-container"></div>
    <div class="ctn" id="sql-container"></div>
</body>
</html>
